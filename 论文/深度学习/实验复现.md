# 实验复现



## 一、项目需求

1. propose a novel graph neural network **GraphRec**, which can model graph neural network in social recommendations coherently.
2. provide a principled approach to jointly capture interactions and opinions in the user-item graph.
3. introduce a method to consider heterogeneous strengths of social relations mathematically.
4. demonstrate the effectiveness of the proposed framework on various real-world datasets.



## 二、数据集

### Epinions Dataset

**1) userlist.txt**

The list of crawled users



**2) userTrust.csv**

The trust relationship. For example: 

```
"jo.com,teamfreak16,Mar 24 '11" represents user "jo.com" trusts user "teamfreak16" since Mar 24 '11.
```



**3) userTrusted.csv**

The trusted relationship. For example: 

```
"alien2,jo.com,Apr 13 '11" represents user "alien2" is trusted by "jo.com" since Apr 13 '11.
```



**4) profileAll.csv**

Each line represents a user, the columns are:

```
username
title
location
real name
registration time
homepage
self descriptions
total number of reviews that written
total number of member visits
total number of visits
favorite websites
```

* title

```
There are different titles (see mapping below) in epinions. A user may have multiple titles, we seperated it with "@@", we also use ":-:" to seperate a title and its domain. For example, "5:-:Sports & Outdoors@@6:-:Sports & Outdoors@@3:-:Top 10@@" represents that user has title 5 in "Sports & Outdoors", title 6 in "Sports & Outdoors" and title 3 in "Top 10". The title mapping is:1-Epinions Category Leads;2-Most Popular Reviews;3-Most Popular Authors;4-Top Earning Reviews;5-Epinions Advisors;6-Epinions Top Reviewers; the description of each title can be found at "http://www0.epinions.com/member/community_lists.html/show_~1", replace the number 1 to different title id.
```

**5) userreview.txt**

contains the mapping of user and numver of his reviews. For example:

```
"jo.com,1712" represents that user "jo.com" has written 1712 reviews. This number is crawler by 2011-05-06.
```

**6) review.rar**

contains all the reviews and advices. Each file represents a user's reviews of advices, with the username as filenme.



The userlist, relationship, profile and reviews need to be synchronized in usernames, since some users have no review files or relationship due to the security setting or crawler problem (this amount would be small).



### Ciao Dataset

**1) rating.txt**

```
UserID | products | Categories of the products | rating | helpfulness | time | content of review | {userid:helpfulness voting}
```



**2) userstatistic**

```
userid | registering time | number of reviews | number of trustors
```



**3) trustnetwork**

```
u--->v | trustees(v) | trustors(u)
```



## 三、实现思路





## 四、项目结构

* data/toy_dataset.pickle

* Attention.py

* run_GraphRec_example.py

* Social_Aggregators.py

* Social_Encoders.py

* UV_Aggregators.py

* UV_Encoders.py



## 五、代码文档

### a) preprocess.py

负责数据的预处理

* 变量说明

```
## rating.mat
click_f: 原生数据 rating.mat
click_list: 目标数据
pos_list: 目标数据

user_count: max user id
item_count: max item id
rate_count: max rate value

num_test: 测试集的数量
test_set: 测试数据
valid_set: 验证数据
train_set: 训练数据

click_df: 存放目标数据的容器
test_df: 存放测试数据的容器
valid_df: 存放验证数据的容器
train_df: 存放训练数据的容器

u_items_list: 存储每个用户交互过的所有物品iid和对应的评分
i_users_list: 存储每个物品交互过的所有用户uid和对应的评分

## trustnetwork.mat
trust_f: 原生数据 trustnetwork.mat
trust_list: 目标数据
trust_df: 存放目标数据的容器

u_users_list: 存储每个用户互动过的朋友uid
u_users_items_list: 存储每个用户互动过的朋友的物品列表iid
```

* 逻辑说明

```
## rating.mat
1.遍历原生数据中的每一行进行处理，获得目标数据。原生数据中的列0、列1、列3分别代表用户id、商品id、评价
2.对目标数据进行去重，并随机调序
3.分割训练数据、验证数据、测试数据
4.将分割后的数据转换为二进制存储
5.将数据集存放到相应容器里
6.按uid排序，并存储每个用户交互过的所有物品iid和对应的评分
7.按iid排序，并存储每个物品交互过的所有用户uid和对应的评分

## trustnetwork.mat
1.遍历原生数据中的每一行进行处理，获得目标数据。原生数据中的列0、列1分别代表用户id、相邻用户id
2.按uid排序，并存储每个用户交互过的所有朋友uid
3.按uid排序，并存储每个用户交互过的所有朋友的物品列表iid

make all the graph list in binary file
```



### b) main.py

调用模型进行数据处理



### c) model.py

提供不同的模型





## 六、实验结果

D:\Users\ZZZZ76\anaconda3\python.exe "D:\Program Files\JetBrains\PyCharm 2019.2.6\helpers\pydev\pydevconsole.py" --mode=client --port=61533
import sys; print('Python %s on %s' % (sys.version, sys.platform))
sys.path.extend(['E:\\PycharmProjects\\GraphRec-WWW19', 'E:/PycharmProjects/GraphRec-WWW19'])
Python 3.7.6 (default, Jan  8 2020, 20:23:39) [MSC v.1916 64 bit (AMD64)]
Type 'copyright', 'credits' or 'license' for more information
IPython 7.12.0 -- An enhanced Interactive Python. Type '?' for help.
PyDev console: using IPython 7.12.0
Python 3.7.6 (default, Jan  8 2020, 20:23:39) [MSC v.1916 64 bit (AMD64)] on win32
runfile('E:/PycharmProjects/GraphRec-WWW19/run_GraphRec_example.py', wdir='E:/PycharmProjects/GraphRec-WWW19')
[1,     0] loss: 0.081, The best rmse/mae: 9999.000000 / 9999.000000
[1,   100] loss: 5.712, The best rmse/mae: 9999.000000 / 9999.000000
rmse: 2.0304, mae:1.8604 
[2,     0] loss: 0.036, The best rmse/mae: 2.030437 / 1.860380
[2,   100] loss: 2.726, The best rmse/mae: 2.030437 / 1.860380
rmse: 1.0889, mae:0.9257 
[3,     0] loss: 0.020, The best rmse/mae: 1.088924 / 0.925745
[3,   100] loss: 1.624, The best rmse/mae: 1.088924 / 0.925745
rmse: 1.3906, mae:1.1508 
[4,     0] loss: 0.014, The best rmse/mae: 1.088924 / 0.925745
[4,   100] loss: 1.281, The best rmse/mae: 1.088924 / 0.925745
rmse: 0.8288, mae:0.6656 
[5,     0] loss: 0.009, The best rmse/mae: 0.828758 / 0.665612
[5,   100] loss: 1.116, The best rmse/mae: 0.828758 / 0.665612
rmse: 0.8453, mae:0.6642 
[6,     0] loss: 0.010, The best rmse/mae: 0.828758 / 0.665612
[6,   100] loss: 1.059, The best rmse/mae: 0.828758 / 0.665612
rmse: 0.8532, mae:0.6704 
[7,     0] loss: 0.008, The best rmse/mae: 0.828758 / 0.665612
[7,   100] loss: 0.981, The best rmse/mae: 0.828758 / 0.665612
rmse: 0.8517, mae:0.6403 
[8,     0] loss: 0.010, The best rmse/mae: 0.828758 / 0.665612
[8,   100] loss: 0.927, The best rmse/mae: 0.828758 / 0.665612
rmse: 0.8731, mae:0.6546 
[9,     0] loss: 0.008, The best rmse/mae: 0.828758 / 0.665612
[9,   100] loss: 0.912, The best rmse/mae: 0.828758 / 0.665612
rmse: 0.8076, mae:0.6284 
[10,     0] loss: 0.010, The best rmse/mae: 0.807645 / 0.628363
[10,   100] loss: 0.850, The best rmse/mae: 0.807645 / 0.628363
rmse: 0.8146, mae:0.6419 
[11,     0] loss: 0.009, The best rmse/mae: 0.807645 / 0.628363
[11,   100] loss: 0.834, The best rmse/mae: 0.807645 / 0.628363
rmse: 0.8326, mae:0.6370 
[12,     0] loss: 0.007, The best rmse/mae: 0.807645 / 0.628363
[12,   100] loss: 0.805, The best rmse/mae: 0.807645 / 0.628363
rmse: 0.8297, mae:0.6281 
[13,     0] loss: 0.008, The best rmse/mae: 0.807645 / 0.628363
[13,   100] loss: 0.779, The best rmse/mae: 0.807645 / 0.628363
rmse: 0.8209, mae:0.6523 
[14,     0] loss: 0.007, The best rmse/mae: 0.807645 / 0.628363
[14,   100] loss: 0.745, The best rmse/mae: 0.807645 / 0.628363
rmse: 0.8125, mae:0.6265 
[15,     0] loss: 0.007, The best rmse/mae: 0.807645 / 0.628363
[15,   100] loss: 0.730, The best rmse/mae: 0.807645 / 0.628363
rmse: 0.8254, mae:0.6433 



## 八、相关实验

计划依次对四个主流实验进行复现对比，同时提出一个全新的规范化矩阵分解的方法

* 基于协同过滤的服务推荐（结合地里信息）

* 基于矩阵分解的服务推荐（结合地里信息）

* 基于深度学习的服务推荐（结合地里信息）

* 基于规范化矩阵分解的服务推荐（结合地里信息）



## 九、学习资料

黑马推荐系统：

* 推荐系统简介（代码+课件）
* 推荐算法（代码+课件）



尚硅谷推荐系统

* 推荐理论（代码+课件）





